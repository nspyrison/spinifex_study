---
title: "Simulating data and it's cluster seperation"
output:
  html_document:
    #code_folding: hide
    toc: true
    toc_depth: 3
---
```{r setup_condensed, include=F}
## Setup
require("knitr")
require("spinifex")
require("tourr")
require("ggplot2")
require("tibble")
require("dplyr")
knitr::opts_chunk$set(
  echo      = FALSE,
  include   = TRUE,
  message   = FALSE, warning = FALSE, error = FALSE,
  results   = "markup",              ## Opts: "asis", "markup", "hold", "hide"
  fig.align = "center",              ## Opts: "left", "right", "center", "default"
  fig.width = 8, fig.height = 5,
  out.width = "100%",
  fig.pos   = "h", out.extra   = "", ## Figures forced closer to chunk location.
  collapse  = TRUE, cache = TRUE, cache.lazy = FALSE
)
## Set global knit options in Tools > Global Options > R Markdown tab > X:
##   root path, chunk output, etc. so we don't need: 

## For console
source("./R/ggproto_screeplot_pca.r")
source("./R/ggproto_screeplot_clSep.r")
source("./R/MMP_clSep.r")
source("./R/geom_lda_points.r")
source("./R/geom_lda_points.r")
source("./R/ggpcapairs.r")

## Global init, and theme
top_n_manual_tours <- 3 ## keeps run time and length of content resonable.
permutation_reps <- 100
set.seed(20200903)
theme_set(theme_minimal())
palette(RColorBrewer::brewer.pal(8, "Dark2"))

## Load rmvnorm sims
if(F) ## For generation see this file:
  file.edit("./catalogue/sim_mvnorm.r")
## Load data
obj_nms <- c("sim_VII", "sim_EEE", "sim_VVV")
i_s <- 1:length(obj_nms)
for(i in i_s){
  load(file = paste0("./catalogue/simulations/", obj_nms[i], ".rda"))
}
## Context -- simulation information
sim1 <- get(obj_nms[1])
p    <- ncol(sim1)
k_cl <- length(unique(sim1[, 1]))
```

# Models VII, EEE, and VVV

All models simulated with `r p` dimensions and `r k_cl` clusters. Manual tours for the top `r top_n_manual_tours` variables (in terms of MMP cluster seperation).

## MMP Cluster Seperation
```{r}
for(i in i_s){
  ## Initialize
  sim_nm   <- obj_nms[i]
  model_nm <- substr(sim_nm, 5, 7)
  dat  <- get(sim_nm)
  clas <- attr(dat, "cl_lvl")
  
  #debugonce(ggproto_MMP_clSep)
  ## MMP ClSep
  print(paste0(sim_nm, ":"))
  print(ggplot() + ggproto_MMP_clSep(dat, clas, n_reps = permutation_reps))
}
```

## PCA
```{r pca}
for(i in i_s) {
  ## Initialize
  sim_nm   <- obj_nms[i]
  model_nm <- substr(sim_nm, 5, 7)
  dat  <- get(sim_nm)
  clas <- attr(dat, "cl_lvl")
  
  ## PCA
  print(paste0(sim_nm, ":"))
  print(round(prcomp(dat)$rotation, 2))
  print(ggpcapairs(x = dat, class = clas, top_n = 3) +
    ggplot2::scale_color_manual(values = palette()[1:k_cl]) +
    ggplot2::scale_fill_manual( values = palette()[1:k_cl]))
  #print(ggplot() + ggproto_screeplot_pca(dat))
}
```

## Manual tours
```{r manual_tours}
if(F){
  console_path <- "./catalogue/images/"
  for(i in i_s) {
    ## Initialize
    sim_nm   <- obj_nms[i]
    model_nm <- substr(sim_nm, 5, 7)
    dat  <- get(sim_nm)
    clas <- attr(dat, "cl_lvl")
    
    ## Manual tours
    pca_bas <- as.matrix(prcomp(dat)$rotation[, 1:2])
    mmp_clsep <- df_scree_MMP_clSep(dat, clas, n_reps = permutation_reps)
    tour_manip_nums <- mmp_clsep$data_colnum[1:top_n_manual_tours]
    for (i in 1:length(tour_manip_nums)){
      play_manual_tour(basis = pca_bas,
                       data = dat,
                       fps = 9L,
                       manip_var = tour_manip_nums[i],
                       render_type = render_gganimate,
                       col = clas, pch = clas,
                       axes = "left",
                       gif_filename = paste0("radialTour_", sim_nm, 
                                             "_mvar", tour_manip_nums[i], ".gif"),
                       gif_path = console_path,
                       ggtheme = list(
                         scale_color_manual(values = palette()[1:k_cl]),
                         theme_void()
                       )
      )
    } ## End of for radial tour creation loop
  } ## End of for groups loop
} ## End of if(F), don't run.
```

All manual tours start from PCA initalized basis.

VII:

![](images/radialTour_sim_VII_mvar2.gif)
![](images/radialTour_sim_VII_mvar1.gif)


EEE:

![](images/radialTour_sim_EEE_mvar1.gif)
![](images/radialTour_sim_EEE_mvar2.gif)


VVV:

![](images/radialTour_sim_VVV_mvar1.gif)
![](images/radialTour_sim_VVV_mvar2.gif)

## LDA 
```{r lda}
for(i in i_s) {
  ## Initialize
  sim_nm   <- obj_nms[i]
  model_nm <- substr(sim_nm, 5, 7)
  dat  <- get(sim_nm)
  clas <- attr(dat, "cl_lvl")
  
  ## LDA
  print(paste0(sim_nm, ":"))
  MASS::lda(dat, grouping = clas)
  if(length(unique(clas)) > 2){
    print(ggplot() + geom_lda_points(dat, clas))
  } else warning("LDA not called, fewer than 2 classes.")
}
```

# {mclust} paper reference

Scrucca, Luca, Michael Fop, T. Brendan Murphy, and Adrian E. Raftery. "Mclust 5: Clustering, Classification and Density Estimation Using Gaussian Finite Mixture Models." The R Journal 8, no. 1 (August 2016): 289-317.

## mclust paper, Table 3 
![](./images/mclust_table3.png)

## mclust paper, Figure 2
![](./images/mclust_figure2.png)


